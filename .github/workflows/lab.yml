name: Laboratory

on:
  push:

jobs:
  lab:
    runs-on: ubuntu-latest
    steps:
      - name: Collect Docker labels & tags
        id: docker-labels-tags
        run: |
            echo 'labels<<__LABELS_EOF__' >> $GITHUB_OUTPUT
            echo "org.opencontainers.image.title=foo" >> $GITHUB_OUTPUT
            echo "org.opencontainers.image.description=Some description" >> $GITHUB_OUTPUT
            echo "org.opencontainers.image.revision=${{ github.sha }}" >> $GITHUB_OUTPUT
            echo "org.opencontainers.image.licenses=MIT" >> $GITHUB_OUTPUT
            echo "org.opencontainers.image.source=https//github.com/${{ github.repository }}/tree/${{ github.sha }}" >> $GITHUB_OUTPUT
            echo "org.opencontainers.image.documentation=https//github.com/${{ github.repository }}" >> $GITHUB_OUTPUT
            echo '__LABELS_EOF__' >> $GITHUB_OUTPUT

            echo 'tags<<__TAGS_EOF__' >> $GITHUB_OUTPUT
            echo "ghcr.io/${{ github.repository }}/foo:${{ github.ref_name == 'main' && 'latest' || 'edge' }}" >> $GITHUB_OUTPUT
            echo "ghcr.io/${{ github.repository }}/foo:git-${{ github.ref_name }}-${{ github.sha }}" >> $GITHUB_OUTPUT
            echo '__TAGS_EOF__' >> $GITHUB_OUTPUT

      - name: Consume Docker labels
        run: echo "${{ steps.docker-labels-tags.outputs.labels }}" | sed -e 's/^/- 🏷 /gm' >> $GITHUB_STEP_SUMMARY
      - name: Consume Docker tags
        run: echo "${{ steps.docker-labels-tags.outputs.tags }}" | sed -e 's/^/- 🐳 /gm' >> $GITHUB_STEP_SUMMARY
